setg THREADS 150
spool /root/output/msf/udp_scan.txt
echo "####ADDITIONAL CHECKS####"

echo "udp_probe - Detect common UDP services using sequential probes"
use auxiliary/scanner/discovery/udp_probe
hosts -R
run
sleep 5

echo "udp_sweep - Detect interesting UDP Services"
use auxiliary/scanner/discovery/udp_sweep
hosts -R
run
sleep 5

spool /root/output/msf/dns.txt
echo "####DNS####"

echo "DNS Amplification Scanner"
use auxiliary/scanner/dns/dns_amp
hosts -R
run
sleep 5
spool /root/output/msf/snmp.txt
echo "####SNMP####"

echo "snmp_login - This module logs in to SNMP devices using common community names"
use auxiliary/scanner/snmp/snmp_login
services -u -p 161 -R
set VERSION all
run
sleep 5
spool /root/output/msf/ftp.txt
echo "####FTP####"

echo "ftp_version - Detect FTP Version - Set password for username"
use auxiliary/scanner/ftp/ftp_version
services -u -p 21 -R
set FTPPASS ProSec_Networks
run
sleep 5

echo "anonymous - Detect anonymous read_write FTP server access"
use auxiliary/scanner/ftp/anonymous
services -u -p 21 -R
run
sleep 5
spool /root/output/msf/sql.txt
echo "####SQL####"

echo "mssql_ping - This module simply queries the MSSQL instance for information"
use auxiliary/scanner/mssql/mssql_ping
hosts -R
run
sleep 5

echo "mssql_login"
use auxiliary/scanner/mssql/mssql_login
services -u -p 1433 -R
set PASSWORD pass
run
sleep 5

echo "mysql_version - Enumerates the version of MySQL servers"
use auxiliary/scanner/mysql/mysql_version
services -u -p 3306 -R
run
sleep 5

echo "mysql_login"
use scanner/mysql/mysql_login
services -p 3306 -u -R
run
sleep 5

echo "postgres_version - Enumerates the version of PostgreSQL servers"
use auxiliary/scanner/postgres/postgres_version
services -u -p 5432 -R
run
sleep 5

echo "postgresql_login"
use scanner/postgres/postgres_login
services -p 5432 -u -R
run
sleep 5

spool /root/output/msf/smb.txt
echo "####SMB####"

echo "smb_version - Display version information about each system"
use auxiliary/scanner/smb/smb_version
hosts -R
run
sleep 5

echo "smb_enumshares - This module determines what shares are provided by the SMB service"
use auxiliary/scanner/smb/smb_enumshares
hosts -R
set ShowFiles true
set SpiderShares false
run
sleep 5

echo "smb_enumusers - Determine what local users exist via the SAM RPC service"
use auxiliary/scanner/smb/smb_enumusers
hosts -R
run
sleep 5

echo "smb_ms17_010 - Check for MS17-010 - DoublePulsar infection"
use auxiliary/scanner/smb/smb_ms17_010
services -u -p 445 -R
run
sleep 5

spool /root/output/msf/mail.txt
echo "####MAIL####"

echo "smtp_version - SMTP Banner Grabber"
use auxiliary/scanner/smtp/smtp_version
services -u -p 25 -R
run
sleep 5

echo "smtp_relay - SMTP Server e-mail accept check"
use auxiliary/scanner/smtp/smtp_relay
services -u -p 25 -R
set MAILFROM d.fink@prosec-networks.com
set MAILTO d.fink@prosec-networks.com
set EXTENDED true
run
sleep 5

echo "imap_version - IMAP4 Banner Grabber"
use auxiliary/scanner/imap/imap_version
services -u -p 143 -R
run
sleep 5

echo "pop3_version - POP3 Banner Grabber"
use auxiliary/scanner/pop3/pop3_version
services -u -p 110 -R
run
sleep 5

spool /root/output/msf/telnet.txt
echo "####TELNET####"

echo "telnet_version - Detect telnet services"
use auxiliary/scanner/telnet/telnet_version
services -u -p 23 -R
run
sleep 5

echo "lantronix_telnet_version - Detect Lantronix telnet services"
use auxiliary/scanner/telnet/lantronix_telnet_version
services -u -p 9999 -R
run
sleep 5

echo "telnet_ruggedcom - This module will calculate the password for the hard-coded hidden username factory in the ROS"
use auxiliary/scanner/telnet/telnet_ruggedcom
services -u -p 23 -R
run
sleep 5

spool /root/output/msf/ssh.txt
echo "####SSH####"

echo "ssh_version - Detect SSH VERSION"
use auxiliary/scanner/ssh/ssh_version
services -u -s ssh -R
run
sleep 5

spool /root/output/msf/printer.txt
echo "####PRINTER####"

echo "printer_list_dir - This module lists a directory on a set of printers using the Printer Job Language (PJL) protocol"
use auxiliary/scanner/printer/printer_list_dir
services -u -p 9100 -R
run
sleep 5

echo "printer_version_info - Printer Version Info via PJL"
use auxiliary/scanner/printer/printer_version_info
services -u -p 9100 -R
run
sleep 5

spool /root/output/msf/vmware.txt
echo "####VMware#####"

echo "esx_fingerprint - VMware ESX_ESXi Version Info via web API"
use auxiliary/scanner/vmware/esx_fingerprint
services -u -p 443 -R
run
sleep 5

echo "VMware vCenter Server Virtual SAN Health Check Plugin RCE"
use exploit/linux/http/vmware_vcenter_vsan_health_rce
hosts -S vCenter -R
check
sleep 5

echo "VMware vCenter Server vmdir Information Disclosure"
use auxiliary/gather/vmware_vcenter_vmdir_ldap
hosts -S vCenter -R
run
sleep 5

echo "VMware vCenter Server vmdir Authentication Bypass"
use auxiliary/admin/ldap/vmware_vcenter_vmdir_auth_bypass
hosts -S vCenter -R
check
sleep 5

echo "VMware vCenter Server Unauthenticated OVA File Upload RCE"
use exploit/multi/http/vmware_vcenter_uploadova_rce
hosts -S vCenter -R
check
sleep 5

echo "VMware vRealize Operations (vROps) Manager SSRF RCE"
use exploit/linux/http/vmware_vrops_mgr_ssrf_rce 
hosts -S vmware -R
set srvport 8081
check
sleep 5

spool /root/output/msf/rdp.txt
echo "####RDP####"

echo "RDP Scanner"
use auxiliary/scanner/rdp/rdp_scanner
hosts -R
run
sleep 5

echo "MS12-020 Check"
use auxiliary/scanner/rdp/ms12_020_check
services -u -p 3389 -R
run
sleep 5

echo "CVE-2019-708 aka Bluekeep"
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
services -u -p 3389 -R
run
sleep 5

spool /root/output/msf/ipmi.txt
echo "####IPMI####"

echo "IPMI Information Discovery"
use auxiliary/scanner/ipmi/ipmi_version
hosts -R
run
sleep 5

echo "IPMI Cipher Zero"
use auxiliary/scanner/ipmi/ipmi_cipher_zero
services -p 623 -u -R
run
sleep 5

echo "IPMI Hashdump"
use scanner/ipmi/ipmi_dumphashes
set OUTPUT_HASHCAT_FILE /root/output/loot/hashes/ipmi_hashcat
services -p 623 -u -R
run
sleep 5

spool /root/output/msf/ntp.txt
echo "NTP Monlist"
use scanner/ntp/ntp_monlist
services -p 123 -u -R
run
sleep 5

spool /root/output/msf/rpc.txt
echo "RPC Endpoint Mapper"
use auxiliary/scanner/dcerpc/endpoint_mapper
services -p 135 -u -R
run
sleep 5
services -p 135 -u
sleep 5

echo "SunRPC Portmapper"
use auxiliary/scanner/misc/sunrpc_portmapper
services -p 111 -u -R
run
sleep 5
services -p 111
sleep 5

spool /root/output/msf/ldap.txt
echo "LDAP Hashdump"
use auxiliary/gather/ldap_hashdump
services -p 636 -u -R
run
sleep 5

spool /root/output/msf/ssdp.txt
echo "SSDP Amp"
use auxiliary/scanner/upnp/ssdp_amp
services -p 1900 -R
run
sleep 5

spool off


hosts -S Windows -c name,address -o /root/output/msf/zerohosts.txt
hosts -o /root/output/list/msf_hosts.txt
services -o /root/output/list/msf_services.txt

exit
